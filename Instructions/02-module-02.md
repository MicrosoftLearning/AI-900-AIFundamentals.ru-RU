---
lab:
  title: Изучение автоматизированного машинного обучения в Машинном обучении Azure
---

# Изучение автоматизированного машинного обучения в Машинном обучении Azure

В этом упражнении вы будете использовать функцию автоматизированного машинного обучения в Машинном обучении Azure для обучения и оценки модели машинного обучения. Затем вы развернете и протестируете обученную модель.

Выполнение этого упражнения займет около **30** минут.

> **Примечание** Чтобы выполнить это задание вам потребуется [подписка Azure](https://azure.microsoft.com/free), по которой у вас есть административный доступ.

## Создание рабочей области машинного обучения Azure

Чтобы использовать Машинное обучение Azure, необходимо подготовить рабочую область Машинного обучения Azure в подписке Azure. Затем вы сможете использовать Студия машинного обучения Azure для работы с ресурсами в рабочей области.

> **Совет**. Если у вас уже есть рабочая область Машинного обучения Azure, вы можете использовать ее и перейти к следующей задаче.

1. Войдите в [портал Azure](https://portal.azure.com) с `https://portal.azure.com` помощью учетных данных Майкрософт.

1. Выберите **+ Создать ресурс**, найдите *Машинное обучение* и создайте новый ресурс **Машинного обучения Azure** со следующими параметрами:
    - **Подписка**: *ваша подписка Azure*.
    - **Группа ресурсов**: *создайте или выберите группу ресурсов*.
    - **Имя**. *Введите уникальное имя рабочей области*.
    - **Регион**: *выберите ближайший к вам географический регион*.
    - **Учетная запись хранения**: *обратите внимание на новую учетную запись хранения по умолчанию, которая будет создана для рабочей области*.
    - **Хранилище ключей**: *обратите внимание на новое хранилище ключей по умолчанию, которое будет создано для рабочей области*.
    - **Application Insights**: *обратите внимание на новый ресурс Application Insights по умолчанию, который будет создан для рабочей области*.
    - **Реестр контейнеров**: нет (*один будет создан автоматически при первом развертывании модели в контейнере*).

1. Выберите **Проверить и создать**, а затем выберите **Создать**. Дождитесь создания рабочей области (это может занять несколько минут), а затем перейдите к развернутому ресурсу.

1. Выберите **Запустить Студию** (или откройте новую вкладку браузера и перейдите по адресу [https://ml.azure.com](https://ml.azure.com?azure-portal=true)), а затем войдите в Студию машинного обучения Azure, используя свою учетную запись Майкрософт. Закройте все отображаемые сообщения.

1. В Студии машинного обучения Azure вы увидите только что созданную рабочую область. В противном случае выберите **Все рабочие области** в меню слева и выберите только что созданную рабочую область.

## Включение предварительной версии функций

Некоторые функции Машинного обучения Azure доступны в предварительной версии и должны быть явно включены в рабочей области.

1. В Студии машинного обучения Azure щелкните **Управление предварительными версиями функций** (значок громкоговорителя — &#128363;).

    ![Снимок экрана: кнопка "Управление предварительными версиями функций" в меню.](../instructions/media/use-automated-machine-learning/severless-compute-1.png)

1. Включите следующую предварительную версию функции:

    - *Интерактивный интерфейс для отправки заданий обучения с помощью бессерверных вычислений*

## Использование автоматизированного машинного обучения для обучения модели

Автоматизированное машинное обучение позволяет опробовать несколько алгоритмов и параметров для обучения нескольких моделей и определить оптимальный вариант для ваших данных. В этом упражнении вы будете использовать набор данных исторических сведений о прокате велосипедов для обучения модели, которая прогнозирует количество прокатов велосипедов, которое следует ожидать в данный день, на основе сезонных и метеорологических признаков.

> **Ссылка**. *Данные, используемые в этом упражнении, являются производными от [Capital Bikeshare](https://www.capitalbikeshare.com/system-data) и используются в соответствии с опубликованным [лицензионным соглашением](https://www.capitalbikeshare.com/data-license-agreement) о данных*.


1. В [Студия машинного обучения Azure](https://ml.azure.com?azure-portal=true) просмотрите страницу **Автоматизированное машинное обучение** (в разделе **Разработка**).

1. Создайте новое задание автоматизированного машинного обучения со следующими параметрами, используя **далее** по мере необходимости для выполнения в пользовательском интерфейсе:

    **Основные параметры**:

    - **Имя задания**: mslearn-bike-automl
    - **Имя нового эксперимента**: mslearn-bike-rental
    - **Описание**: Автоматизированное машинное обучение для прогнозирования аренды велосипедов
    - **Теги**: *нет*

   **Тип задачи & данных**:

    - **Выбор типа задачи**: Регрессия
    - **Выберите набор данных**. Создайте новый набор данных со следующими параметрами:
        - **Тип данных**:
            - **Имя**: bike-rentals
            - **Описание**: исторические данные об аренде велосипедов
            - **Тип**: табличный
        - **Источник данных**:
            - Выбор **из веб-файлов**
        - **URL веб-узла**
            - **URL веб-узла**: ****
            - **Пропустить проверку данных**: *не выбирайте*.
        - **Параметры**:
            - **Формат файлов**: с разделением
            - **Разделитель**: запятая
            - **Кодирование**: UTF-8
            - **Заголовки столбцов**: заголовки содержит только первый файл
            - **Пропуск строк**: Нет
            - **Набор данных содержит несколько строк**: *не выбирайте этот параметр*
        - **Схема**:
            - включить все столбцы, кроме столбца **Путь**
            - Проверка автоматически обнаруженных типов

        Выберите набор данных **проката велосипедов** после его создания.

    **Параметры задачи**:

    - **Тип задачи**: Регрессия
    - **Набор данных**: bike-rentals
    - **Целевой столбец**: Прокат (целое число)
    - **Дополнительные параметры конфигурации**:
        - **Основная метрика**: нормализованная среднеквадратическая погрешность
        - **Объяснение лучшей модели**: *не выбрано*
        - **Использовать все поддерживаемые модели**: <u>не</u> выбрано. *Вы ограничите задание, чтобы опробовать только несколько конкретных алгоритмов.*
        - **Допустимые модели**: *выберите только **RandomForest** и **LightGBM**. Обычно следует испробовать как можно больше моделей, но каждая добавленная модель увеличивает время, затрачиваемое на выполнение задание.*
    - **Ограничения**: *разверните этот раздел*
        - **Максимальное число пробных версий**: 3
        - **Максимальное количество одновременных пробных версий**: 3
        - **Максимальное число узлов**: 3
        - **Пороговое значение оценки метрики**: 0,85 (*чтобы если модель достигла нормализованного среднего квадратного значения метрики погрешности 0,085 или меньше, задание завершается).*
        - **Время ожидания**: 15
        - **Время ожидания итерации**: 5
        - **Включить досрочное завершение:** *выбрано*
    - **Проверка и тестирование**.
        - **Тип проверки**: разделение обучения и проверки
        - **Процент проверочных данных**: 10
        - **Тестовый набор данных**: нет

    **Среда выполнения приложений**

    - **Выбор типа вычислений**: бессерверный
    - **Тип виртуальной машины**: ЦП
    - **Уровень виртуальной машины**: низкий приоритет
    - **Размер виртуальной машины**: Standard_DS3_V2
    - **Количество экземпляров**: 1

1. Отправьте задание обучения. Он запускается автоматически.

1. Дождитесь остановки задания. Это может занять некоторое время, так что можете побаловать себя чашечкой кофе!

## Проверка наилучшей модели

После завершения задания автоматизированного машинного обучения можно просмотреть наилучшую обученную модель.

1. На вкладке **Обзор** задания автоматизированного машинного обучения изучите сводку по самой лучшей модели.
    ![Снимок экрана: сводка по самой лучшей модели задания автоматизированного машинного обучения, имя алгоритма выделено прямоугольником.](media/use-automated-machine-learning/complete-run.png)

    > **Примечание** В состоянии "Предупреждение: достигнута оценка выхода, указанная пользователем..." может отображаться сообщение. Это ожидаемое сообщение. После этого перейдите к следующему шагу.
  
1. Выберите текст в разделе **Имя алгоритма** для лучшей модели, чтобы просмотреть сведения о ней.

1. Перейдите на вкладку **Метрики** и выберите диаграммы **residuals** и **predicted_true**, если они еще не выбраны. 

    Изучите диаграммы, показывающие производительность модели. На **диаграмме остатков** отображаются *остатки* (различия между прогнозируемыми и фактическими значениями) в виде гистограммы. Диаграмма **predicted_true** сравнивает прогнозируемые значения с истинными значениями. 

## Развертывание и тестирование модели

1. На вкладке **Модель** для оптимальной модели, обученной заданием автоматического машинного обучения, выберите **Развернуть** и используйте параметр **Веб-служба** , чтобы развернуть модель со следующими параметрами:
    - **Имя**: predict-rentals
    - **Описание**: Прогнозирование проката велосипедов
    - **Тип вычисления**: Экземпляр контейнера Azure
    - **Включить проверку подлинности**: *выбрано*

1. Подождите, пока начнется развертывание. Это может занять несколько секунд. **Состояние развертывания** для конечной точки **predict-rentals** будет указано в main части страницы как *Выполняется*.
1. Подождите, пока **состояние развертывания** изменится на *Успешно*. Это может занять 5–10 минут.

## Тестирование развернутой службы

Теперь можно протестировать развернутую службу.

1. В Студия машинного обучения Azure в меню слева выберите **Конечные точки** и откройте конечную точку **predict-rentals** в режиме реального времени.

1. На странице конечная точка **predict-rentals** в режиме реального времени откройте вкладку **Тест** .

1. В области **Входные данные для тестирования конечной точки** замените шаблон JSON следующими входными данными:

    ```JSON
    {
      "Inputs": { 
        "data": [
          {
            "day": 1,
            "mnth": 1,   
            "year": 2022,
            "season": 2,
            "holiday": 0,
            "weekday": 1,
            "workingday": 1,
            "weathersit": 2, 
            "temp": 0.3, 
            "atemp": 0.3,
            "hum": 0.3,
            "windspeed": 0.3 
          }
        ]    
      },   
      "GlobalParameters": 1.0
    }
    ```

1. Нажмите кнопку **Проверить**.

1. Просмотрите результаты теста, которые включают прогнозируемое количество аренды на основе входных признаков. Примерно так:

    ```JSON
    {
      "Results": [
        444.27799000000000
      ]
    }
    ```

    На панели тестирования были введены входные данные и использована модель, обученная для возврата прогнозируемого числа прокатов.


Давайте посмотрим, что у вас получилось. Для обучения модели использовался набор данных об аренде велосипедов за прошедшие периоды. Модель прогнозирует ожидаемого количество велосипедов, взятых напрокат в течение определенного дня, на основе сезонных и метеорологических *признаков*.

## Очистка

Созданная веб-служба размещается в *экземпляре контейнера Azure*. Если вы не планируете экспериментировать с ним и дальше, следует удалить конечную точку, чтобы избежать лишнего использования ресурсов Azure. Необходимо также удалить вычислительный кластер.

1. В [студии машинного обучения Azure](https://ml.azure.com?azure-portal=true) на вкладке **Конечные точки** выберите конечную точку **predict-rentals**. Затем щелкните **Удалить** и подтвердите удаление конечной точки.

    Удаление вычислительных ресурсов гарантирует, что с вашей подписки не будет взиматься плата за вычислительные ресурсы. Однако с вас будет взиматься небольшая плата за хранение данных, так как в вашей подписке существует рабочая область Машинного обучения Azure. Если вы завершили изучение возможностей Машинного обучения Azure, можно удалить рабочую область Машинного обучения Azure и связанные с ней ресурсы.

Чтобы удалить рабочую область:

1. На [портале Microsoft Azure](https://portal.azure.com?azure-portal=true) (страница **Группы ресурсов**) откройте группу ресурсов, указанную при создании рабочей области машинного обучения Azure.
2. Щелкните **Удалить группу ресурсов**, введите имя группы ресурсов, чтобы подтвердить ее удаление, и выберите **Удалить**.
