---
lab:
  title: Изучение автоматизированного машинного обучения в Машинном обучении Azure
---

# Изучение автоматизированного машинного обучения в Машинном обучении Azure

В этом упражнении вы будете использовать функцию автоматизированного машинного обучения в Машинное обучение Azure для обучения и оценки модели машинного обучения. Затем вы развернете и протестируете обученную модель.

Это упражнение должно занять около **30** минут.

> **Примечание**. Для выполнения этого задания вам потребуется [подписка Azure](https://azure.microsoft.com/free), в которой у вас есть административный доступ.

## Создание рабочей области машинного обучения Azure

Чтобы использовать Машинное обучение Azure, необходимо подготовить рабочую область Машинное обучение Azure в подписке Azure. Затем вы сможете использовать Студия машинного обучения Azure для работы с ресурсами в рабочей области.

> **Совет.** Если у вас уже есть рабочая область Машинное обучение Azure, ее можно использовать и перейти к следующей задаче.

1. Войдите в [портал Azure](https://portal.azure.com) `https://portal.azure.com` с помощью учетных данных Майкрософт.

1. Выберите **и создайте ресурс**, выполните поиск *Машинное обучение и создайте ресурс **Машинное обучение Azure*** со следующими параметрами:
    - **Подписка**: *ваша подписка Azure*.
    - **Группа ресурсов**: *создайте или выберите группу ресурсов*.
    - **Имя**. *Введите уникальное имя рабочей области*.
    - **Регион**: *выберите ближайший к вам географический регион*.
    - **Учетная запись хранения**: *обратите внимание на новую учетную запись хранения по умолчанию, которая будет создана для рабочей области*.
    - **Хранилище ключей**: *обратите внимание на новое хранилище ключей по умолчанию, которое будет создано для рабочей области*.
    - **Application Insights**: *обратите внимание на новый ресурс Application Insights по умолчанию, который будет создан для рабочей области*.
    - **Реестр контейнеров**: нет (*один будет создан автоматически при первом развертывании модели в контейнере*).

1. Выберите **Проверить и создать**, а затем выберите **Создать**. Дождитесь создания рабочей области (это может занять несколько минут), а затем перейдите к развернутому ресурсу.

1. Выберите **Запустить Студию** (или откройте новую вкладку браузера и перейдите по адресу [https://ml.azure.com](https://ml.azure.com?azure-portal=true)), а затем войдите в Студию машинного обучения Azure, используя свою учетную запись Майкрософт. Закройте все отображаемые сообщения.

1. В Студии машинного обучения Azure вы увидите только что созданную рабочую область. Если нет, выберите **все рабочие области** в меню слева и выберите только что созданную рабочую область.

## Включить функции из предварительной версии

Некоторые функции Машинное обучение Azure доступны в предварительной версии и должны быть явно включены в рабочей области.

1. В Машинное обучение Azure Studio щелкните **управление функциями предварительной версии** (значок громкого докладчика — &128363;).

    ![Снимок экрана: кнопка "Управление функциями предварительного просмотра" в меню.](../instructions/media/use-automated-machine-learning/severless-compute-1.png)

1. Включите следующую функцию предварительной версии:

    - *Интерактивный интерфейс для отправки заданий обучения с бессерверными вычислениями*

## Использование автоматизированного машинного обучения для обучения модели

Автоматизированное машинное обучение позволяет попробовать несколько алгоритмов и параметров для обучения нескольких моделей и определить наиболее подходящий для ваших данных. В этом упражнении вы будете использовать набор данных исторических сведений об аренде велосипедов для обучения модели, которая прогнозирует количество прокатов велосипедов, которые должны ожидаться в течение определенного дня, на основе сезонных и метеорологических признаков.

> **Ссылка**: *данные, используемые в этом упражнении, являются производными от [Capital Bikeshare](https://www.capitalbikeshare.com/system-data) и используются в соответствии с опубликованным [лицензионным соглашением](https://www.capitalbikeshare.com/data-license-agreement)*.


1. В [Студия машинного обучения Azure](https://ml.azure.com?azure-portal=true) просмотрите страницу **автоматизированного машинного обучения** (в разделе **"Разработка**").

1. Создайте новое задание автоматизированного машинного обучения со следующими параметрами, используя **следующее** , как необходимо для выполнения через пользовательский интерфейс:

    **Основные параметры**:

    - **Имя** задания: mslearn-bike-automl
    - **Имя нового эксперимента**: mslearn-bike-rental
    - **Описание**: автоматизированное машинное обучение для прогнозирования аренды велосипедов
    - **Теги**: *нет*

   **Тип задачи и данные**:

    - **Выбор типа** задачи: регрессия
    - **Выберите набор данных: создайте новый набор** данных со следующими параметрами:
        - **Тип данных**:
            - **Имя**: bike-rentals
            - **Описание**: данные об аренде исторических велосипедов
            - **Тип**: табличный
        - **Источник данных**:
            - Выбор **из веб-файлов**
        - **URL-адрес веб-сайта**:
            - **URL веб-узла**: `https://aka.ms/bike-rentals`
            - **Пропустить проверку данных**: *не выбирайте*.
        - **Параметры**:
            - **Формат** файла: разделители
            - **Разделитель**: запятая
            - **Кодировка**: UTF-8
            - **Заголовки столбцов**: заголовки содержит только первый файл.
            - **Пропуск строк**: Нет
            - **Набор данных содержит несколько строк**: *не выбирайте этот параметр*.
        - **Схема**:
            - включить все столбцы, кроме столбца **Путь**
            - Проверка автоматически обнаруженных типов

        Выберите набор данных проката **велосипедов** после его создания.

    **Параметры** задачи:

    - **Тип** задачи: регрессия
    - **Набор данных**: bike-rentals
    - **Целевой столбец**: Прокат (целое число)
    - **Дополнительные параметры конфигурации**:
        - **Первичная метрика**: нормализованная среднеквадратичная ошибка с квадратом
        - **Объяснить лучшую модель**: *отмена выборов*
        - **Использовать все поддерживаемые модели**: <u>не</u> выбрано. *Вы ограничите задание, чтобы опробовать только несколько конкретных алгоритмов.*
        - **Допустимые модели**: *выберите только **RandomForest** и **LightGBM**. Обычно следует испробовать как можно больше моделей, но каждая добавленная модель увеличивает время, затрачиваемое на выполнение задание.*
    - **Ограничения**. *Разверните этот раздел*
        - **Максимальное** количество проб: 3
        - **Максимальное число параллельных** проб: 3
        - **Максимальное** число узлов: 3
        - **Пороговая** оценка метрик: 0,85 (*поэтому если модель достигает нормализованной среднеквадратической оценки метрик с квадратной площадью 0,085 или меньше, задание заканчивается.*)
        - **Время ожидания**: 15
        - **Время ожидания** итерации: 5
        - **Включение досрочного завершения**: *выбрано*
    - **Проверка и проверка**:
        - **Тип** проверки: разделение на обучение
        - **Процент данных** проверки: 10
        - **Тестовый набор** данных: Нет

    **Вычисления.**

    - **Выбор типа** вычислений: бессерверный
    - **Тип виртуальной машины**: ЦП
    - **Уровень виртуальной машины**: Выделенный.
    - **Размер** виртуальной машины: Standard_DS3_V2
    - **Количество экземпляров**: 1

1. Отправьте задание обучения. Она запускается автоматически.

1. Дождитесь остановки задания. Это может занять некоторое время, так что можете побаловать себя чашечкой кофе!

## Проверка наилучшей модели

После завершения задания автоматизированного машинного обучения можно просмотреть лучшую модель, обученную.

1. На вкладке **Обзор** задания автоматизированного машинного обучения изучите сводку по самой лучшей модели.
    ![Снимок экрана: сводка по самой лучшей модели задания автоматизированного машинного обучения, имя алгоритма выделено прямоугольником.](media/use-automated-machine-learning/complete-run.png)

    > **Примечание. Вы** можете увидеть сообщение в состоянии "Предупреждение: указанный пользователем показатель выхода достигнут...". Это ожидаемое сообщение. После этого перейдите к следующему шагу.
  
1. Выберите текст в разделе **Имя алгоритма** для лучшей модели, чтобы просмотреть сведения о ней.

1. Перейдите на вкладку **Метрики** и выберите диаграммы **residuals** и **predicted_true**, если они еще не выбраны. 

    Изучите диаграммы, показывающие производительность модели. На **диаграмме остатков отображаются *остатки*** (различия между прогнозируемыми и фактическими значениями) в виде гистограммы. Диаграмма **predicted_true** сравнивает прогнозируемые значения с истинными значениями. 

## Развертывание и тестирование модели

1. На вкладке **"Модель"** для оптимальной модели, обученной заданием автоматизированного машинного обучения, выберите **"Развернуть** " и используйте **параметр веб-службы** для развертывания модели со следующими параметрами:
    - **Имя**: predict-rentals
    - **Описание**: прогнозирование аренды циклов
    - **Тип** вычислений: экземпляр контейнера Azure
    - **Включение проверки подлинности**: *выбрано*

1. Подождите, пока начнется развертывание. Это может занять несколько секунд. Состояние **** развертывания для конечной **точки прогнозной аренды** будет указано в главной части страницы в качестве *запуска*.
1. **Дождитесь изменения состояния** развертывания на *"Успешно".* Это может занять 5–10 минут.

## Тестирование развернутой службы

Теперь можно протестировать развернутую службу.

1. В Студия машинного обучения Azure в меню слева выберите **конечные точки** и откройте конечную точку **прогнозирования** аренды в режиме реального времени.

1. На странице конечной точки прогнозирования аренды** в режиме реального времени перейдите **на вкладку **"Тест**".

1. **В области входных данных для тестирования конечной точки** замените шаблон JSON следующими входными данными:

    ```JSON
    {
      "Inputs": { 
        "data": [
          {
            "day": 1,
            "mnth": 1,   
            "year": 2022,
            "season": 2,
            "holiday": 0,
            "weekday": 1,
            "workingday": 1,
            "weathersit": 2, 
            "temp": 0.3, 
            "atemp": 0.3,
            "hum": 0.3,
            "windspeed": 0.3 
          }
        ]    
      },   
      "GlobalParameters": 1.0
    }
    ```

1. Нажмите кнопку **Проверить**.

1. Просмотрите результаты теста, включающее прогнозируемое количество аренды на основе входных функций, аналогичное следующему:

    ```JSON
    {
      "Results": [
        444.27799000000000
      ]
    }
    ```

    На панели тестирования были введены входные данные и использована модель, обученная для возврата прогнозируемого числа прокатов.

Давайте посмотрим, что у вас получилось. Для обучения модели использовался набор данных об аренде велосипедов за прошедшие периоды. Модель прогнозирует ожидаемого количество велосипедов, взятых напрокат в течение определенного дня, на основе сезонных и метеорологических *признаков*.

## Очистка

Созданная веб-служба размещается в *экземпляре контейнера Azure*. Если вы не планируете экспериментировать с ним и дальше, следует удалить конечную точку, чтобы избежать лишнего использования ресурсов Azure.

1. В [студии машинного обучения Azure](https://ml.azure.com?azure-portal=true) на вкладке **Конечные точки** выберите конечную точку **predict-rentals**. Затем щелкните **Удалить** и подтвердите удаление конечной точки.

    Удаление вычислительных ресурсов гарантирует, что ваша подписка не будет взиматься за вычислительные ресурсы. Однако с вас будет взиматься небольшая плата за хранение данных, так как в вашей подписке существует рабочая область Машинного обучения Azure. Если вы завершили изучение возможностей Машинного обучения Azure, можно удалить рабочую область Машинного обучения Azure и связанные с ней ресурсы.

Чтобы удалить рабочую область:

1. На [портале Microsoft Azure](https://portal.azure.com?azure-portal=true) (страница **Группы ресурсов**) откройте группу ресурсов, указанную при создании рабочей области машинного обучения Azure.
2. Щелкните **Удалить группу ресурсов**, введите имя группы ресурсов, чтобы подтвердить ее удаление, и выберите **Удалить**.
