---
lab:
  title: Изучение автоматизированного машинного обучения в Машинном обучении Azure
---

# Изучение автоматизированного машинного обучения в Машинном обучении Azure

В этом упражнении вы будете использовать функцию автоматического машинного обучения в Машинном обучении Azure для обучения и оценки модели машинного обучения. Затем вы развернете и протестируете обученную модель.

Выполнение этого упражнения занимает примерно **30** минут.

> **Примечание**. Для выполнения этого задания вам потребуется [подписка Azure](https://azure.microsoft.com/free), в которой у вас есть административный доступ.

## Создание рабочей области машинного обучения Azure

Чтобы использовать Машинное обучение Azure, необходимо подготовить рабочую область Машинного обучения Azure в подписке Azure. Затем вы сможете использовать Студию машинного обучения Azure для работы с ресурсами в вашей рабочей области.

> **Совет**: Если у вас уже есть рабочая область Машинного обучения Azure, вы можете использовать ее и перейти к следующему заданию.

1. Войдите на [портал Azure](https://portal.azure.com) на `https://portal.azure.com` с помощью вашей учетной записи Майкрософт.

1. Выберите **＋Создать ресурс**, выполните поиск по критерию *Машинное обучение* и создайте новый ресурс **Машинное обучение Azure** со следующими параметрами:
    - **Подписка**: *ваша подписка Azure*.
    - **Группа ресурсов**: *создайте или выберите группу ресурсов*.
    - **Имя**: *Введите уникальное имя для рабочей области*.
    - **Регион**: *выберите ближайший к вам географический регион*.
    - **Учетная запись хранения**: *обратите внимание на новую учетную запись хранения по умолчанию, которая будет создана для рабочей области*.
    - **Хранилище ключей**: *обратите внимание на новое хранилище ключей по умолчанию, которое будет создано для рабочей области*.
    - **Application Insights**: *обратите внимание на новый ресурс Application Insights по умолчанию, который будет создан для рабочей области*.
    - **Реестр контейнеров**: нет (*один будет создан автоматически при первом развертывании модели в контейнере*).

1. Выберите **Проверить и создать**, а затем выберите **Создать**. Дождитесь создания рабочей области (это может занять несколько минут), а затем перейдите к развернутому ресурсу.

1. Выберите **Запустить Студию** (или откройте новую вкладку браузера и перейдите по адресу [https://ml.azure.com](https://ml.azure.com?azure-portal=true)), а затем войдите в Студию машинного обучения Azure, используя свою учетную запись Майкрософт. Закройте все отображаемые сообщения.

1. В Студии машинного обучения Azure вы увидите только что созданную рабочую область. Если нет, выберите **Все рабочие области** в меню слева и выберите только что созданную рабочую область.

## Включить функции из предварительной версии

Некоторые функции Машинного обучения Azure доступны в предварительной версии и должны быть явно включены в рабочей области.

1. В Студии Машинного обучения Azure щелкните **управление функциями предварительного просмотра** (значок громкоговорителя - ).

    ![Снимок экрана: кнопка "Управление функциями предварительного просмотра" в меню.](../instructions/media/use-automated-machine-learning/severless-compute-1.png)

1. Включите следующую функцию предварительного просмотра:

    - *Интерактивный интерфейс для отправки заданий обучения с бессерверными вычислениями*

## Используйте автоматизированное машинное обучение для обучения модели

Автоматизированное машинное обучение позволяет попробовать несколько алгоритмов и параметров для обучения нескольких моделей и определить наиболее подходящий для ваших данных. В этом упражнении вы воспользуетесь набором данных из сведений о прокате велосипедов за прошлые периоды, чтобы обучить модель, прогнозирующую ожидаемое число клиентов, берущих напрокат велосипед, в определенный день в зависимости от времени года и погодных условий.

> **Ссылка**: *Данные, используемые в этом упражнении получены от [Capital Bikeshare](https://www.capitalbikeshare.com/system-data) и используются в соответствии с [лицензионным соглашением ](https://www.capitalbikeshare.com/data-license-agreement) в отношении опубликованных данных*.


1. В [Студии Машинного обучения Azure](https://ml.azure.com?azure-portal=true) перейдите на страницу **Автоматизированное ML** (раздел **Разработка**).

1. Создайте новое задание автоматизированного машинного обучения со следующими параметрами, используя кнопку **Далее** по мере необходимости для продвижения по пользовательскому интерфейсу:

    **Основные параметры**:

    - **Имя задания**: mslearn-bike-automl
    - **Имя нового эксперимента**: mslearn-bike-rental
    - **Описание**: Автоматизированное машинное обучение для прогнозирования аренды велосипедов
    - **Теги**: *нет*

   **Тип задания и данные**:

    - **Выбор типа задания**: Регрессия
    - **Выберите набор данных**: Создать новый набор данных со следующими параметрами:
        - **Тип данных**:
            - **Имя**: bike-rentals
            - **Описание**: Исторические данные об аренде велосипедов
            - **Тип**: Табличный
        - **Источник данных**:
            - Выбор **Из веб-файлов**
        - **URL-адрес веб-сайта**:
            - **URL веб-узла**: `https://aka.ms/bike-rentals`
            - **Пропустить проверку данных**: *не выбирайте*.
        - **Параметры**:
            - **Формат файла**: С разделителями
            - **Разделитель**: Запятая
            - **Кодировка**: UTF-8
            - **Заголовки столбцов**: заголовки содержит только первый файл.
            - **Пропуск строк**: Нет
            - **Набор данных содержит несколько строк**: *не выбирайте этот параметр*.
        - **Схема**:
            - включить все столбцы, кроме столбца **Путь**
            - Проверка автоматически обнаруженных типов

        Выберите набор данных **bike-rentals** после его создания.

    **Настройки задания**:

    - **Тип задания**: Регрессия
    - **Набор данных**: bike-rentals
    - **Целевой столбец**: Прокат (целое число)
    - **Дополнительные параметры конфигурации**:
        - **Основная метрика**: Нормализованная среднеквадратическая погрешность
        - **Объяснить лучшую модель**: *Невыбранные*
        - **Использовать все поддерживаемые модели**: <u>не</u> выбрано. *Вы ограничите задание, чтобы опробовать только несколько конкретных алгоритмов.*
        - **Допустимые модели**: *выберите только **RandomForest** и **LightGBM**. Обычно следует испробовать как можно больше моделей, но каждая добавленная модель увеличивает время, затрачиваемое на выполнение задание.*
    - **Ограничения**. *Разверните этот раздел*
        - **Максимальное количество проб**: 3
        - **Максимальное число параллельных проб**: 3
        - **Максимальное число узлов**: 3
        - **Порог оценки метрики**: 0,085 (*задание завершается, если метрика нормализованной среднеквадратической погрешности в модели достигает значения 0,085 или меньше.*)
        - **Время ожидания**: 15
        - **Время ожидания итерации**: 5
        - **Включение досрочного завершения**: *Выбрано*
    - **Проверка и тест**:
        - **Тип проверки**: Разделение обучение-проверка
        - **Процент данных проверки**: 10
        - **Тестовый набор данных**: Нет

    **Вычисления.**

    - **Выбор типа вычислений**: Бессерверный
    - **Тип виртуальной машины**: ЦП
    - **Уровень виртуальной машины**: Выделенный.
    - **Размер виртуальной машины**: Standard_DS3_V2
    - **Количество экземпляров**: 1

1. Отправьте задание обучения. Запускается автоматически.

1. Дождитесь остановки задания. Это может занять некоторое время, так что можете побаловать себя чашечкой кофе!

## Проверка наилучшей модели

После завершения задачи автоматизированного машинного обучения вы можете просмотреть лучшую модель, которую она обучила.

1. На вкладке **Обзор** задания автоматизированного машинного обучения изучите сводку по самой лучшей модели.
    ![Снимок экрана: сводка по самой лучшей модели задания автоматизированного машинного обучения, имя алгоритма выделено прямоугольником.](media/use-automated-machine-learning/complete-run.png)

    > **Примечание** Может появиться сообщение с текстом "Warning: User specified exit score reached…" (Предупреждение! Достигнута оценка выхода, указанная пользователем…). Это ожидаемое сообщение. После этого перейдите к следующему шагу.
  
1. Выберите текст в разделе **Имя алгоритма** для лучшей модели, чтобы просмотреть сведения о ней.

1. Перейдите на вкладку **Метрики** и выберите диаграммы **residuals** и **predicted_true**, если они еще не выбраны. 

    Изучите диаграммы, показывающие производительность модели. На диаграмме **остатков** отображаются *остатки* (различия между прогнозируемыми и фактическими значениями) в виде гистограммы. Диаграмма **predicted_true** сравнивает прогнозируемые значения с истинными значениями. 

## Развертывание и тестирование модели

1. На вкладке **Модель** для лучшей модели, обученной вашим автоматизированным машинным обучением, нажмите на кнопку **Развернуть** и используйте параметр **Развернуть в веб-службе**, чтобы развернуть модель со следующими параметрами:
    - **Имя**: predict-rentals
    - **Описание**: Прогнозирование аренды велосипедов
    - **Тип вычислений**: Экземпляр контейнера Azure
    - **Включить проверку подлинности**: *Выбрано*

1. Подождите, пока начнется развертывание. Это может занять несколько секунд. **Состояние развертывания** для конечной точки **predict-rentals** будет указано в главной части страницы как *Выполнение*.
1. Дождитесь пока **Состояние развертывание** изменится на *Успешно*. Этот может занять 5-10 минут.

## Тестирование развернутой службы

Теперь можно протестировать развернутую службу.

1. В студии Машинного обучения Azure в меню слева выберите **Конечные точки** и откройте конечную в реальном времени **predict-rentals**.

1. На странице конечной точки в реальном времени **predict-rentals** откройте вкладку **Тест**.

1. В области **Входные данные для тестирования конечной точки** замените шаблон JSON указанными ниже входными данными:

    ```JSON
    {
      "Inputs": { 
        "data": [
          {
            "day": 1,
            "mnth": 1,   
            "year": 2022,
            "season": 2,
            "holiday": 0,
            "weekday": 1,
            "workingday": 1,
            "weathersit": 2, 
            "temp": 0.3, 
            "atemp": 0.3,
            "hum": 0.3,
            "windspeed": 0.3 
          }
        ]    
      },   
      "GlobalParameters": 1.0
    }
    ```

1. Нажмите кнопку **Проверить**.

1. Проверьте результаты теста, которые включают прогнозируемое количество прокатов на основе входных функций — примерно так:

    ```JSON
    {
      "Results": [
        444.27799000000000
      ]
    }
    ```

    На панели тестирования были введены входные данные и использована модель, обученная для возврата прогнозируемого числа прокатов.

Давайте посмотрим, что у вас получилось. Для обучения модели использовался набор данных об аренде велосипедов за прошедшие периоды. Модель прогнозирует ожидаемого количество велосипедов, взятых напрокат в течение определенного дня, на основе сезонных и метеорологических *признаков*.

## Очистка

Созданная веб-служба размещается в *экземпляре контейнера Azure*. Если вы не планируете экспериментировать с ним и дальше, следует удалить конечную точку, чтобы избежать лишнего использования ресурсов Azure.

1. В [студии машинного обучения Azure](https://ml.azure.com?azure-portal=true) на вкладке **Конечные точки** выберите конечную точку **predict-rentals**. Затем щелкните **Удалить** и подтвердите удаление конечной точки.

    Удаление вычислений гарантирует, что в вашей подписке не будет начисляться плата за вычислительные ресурсы. Однако с вас будет взиматься небольшая плата за хранение данных, так как в вашей подписке существует рабочая область Машинного обучения Azure. Если вы завершили изучение возможностей Машинного обучения Azure, можно удалить рабочую область Машинного обучения Azure и связанные с ней ресурсы.

Чтобы удалить рабочую область:

1. На [портале Microsoft Azure](https://portal.azure.com?azure-portal=true) (страница **Группы ресурсов**) откройте группу ресурсов, указанную при создании рабочей области машинного обучения Azure.
2. Щелкните **Удалить группу ресурсов**, введите имя группы ресурсов, чтобы подтвердить ее удаление, и выберите **Удалить**.
