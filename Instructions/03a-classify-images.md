---
lab:
  title: Изучение классификации изображений
---

# Изучение классификации изображений

Служба *Компьютерное зрение* в Cognitive Services предоставляет полезные готовые модели для обработки изображений, но для использования возможностей компьютерного зрения вам часто потребуется обучить собственную модель. Например, предположим, что организация по охране дикой природы хочет отслеживать наблюдения за животными с помощью камер, чувствительных к движениям. Изображения, снятые камерами, могут быть использованы для проверки присутствия определенных видов в определенном районе и оказания помощи в усилиях по сохранению исчезающих видов. Для этого организация может воспользоваться *моделью классификации изображений* , которая обучена идентификации различных видов животных на захваченных фотографиях.

В Azure можно использовать службу ***Пользовательское визуальное распознавание*** для обучения модели классификации изображений на основе существующих изображений. Есть два момента, которые нужно учитывать при создании решения для классификации изображений. Во-первых, вы должны обучить модель распознавать разные классы с использованием существующих изображений. Затем, когда модель обучена, ее необходимо опубликовать как службу, которая может использоваться приложениями.

Чтобы протестировать возможности службы "Компьютерное зрение", мы используем простое приложение командной строки, которое выполняется в Cloud Shell. Те же принципы и функции применяются в реальных решениях, таких как веб-сайты или мобильные приложения.

## Перед началом работы

Для выполнения этого задания вам потребуется [подписка Azure](https://azure.microsoft.com/free?azure-portal=true), в которой у вас есть административный доступ.

## Создание ресурса *Cognitive Services*

Для работы со службой "Пользовательское визуальное распознавание" можно создать ресурс **Пользовательского визуального распознавания** или **Cognitive Services**.

>**Примечание** Некоторые ресурсы недоступны в некоторых регионах. При создании как ресурса Пользовательского визуального распознавания, так и ресурса Cognitive Services для доступа к службам Пользовательского визуального распознавания можно использовать только ресурсы, созданные в [определенных регионах](https://azure.microsoft.com/global-infrastructure/services/?products=cognitive-services). Для удобства в инструкциях по конфигурации ниже регион выбран заранее.

Создайте ресурс **Cognitive Services** в подписке Azure.

1. Откройте портал Azure по адресу [https://portal.azure.com](https://portal.azure.com?azure-portal=true) и войдите в него, используя свою учетную запись Майкрософт.

1. Нажмите кнопку **&#65291; Создать ресурс**, выполните поиск по запросу *Cognitive Services* и создайте ресурс **Cognitive Services** со следующими параметрами:
    - **Подписка**: *ваша подписка Azure*.
    - **Группа ресурсов**: *выберите существующую или создайте новую группу ресурсов с уникальным именем*.
    - **Регион:** восточная часть США.
    - **Имя**: *укажите уникальное имя*.
    - **Ценовая категория**: Стандартный S0.
    - **Устанавливая этот флажок, я подтверждаю, что мною прочитаны все приведенные ниже условия и я понимаю их**: флажок установлен.

1. Проверьте и создайте ресурс, а затем дождитесь завершения развертывания. Затем перейдите к развернутому ресурсу.

1. Откройте страницу **Ключи и конечная точка** для своего ресурса Cognitive Services. Для подключения из клиентских приложений потребуются конечная точка и ключи.

## Создание проекта в службе "Пользовательское визуальное распознавание"

Чтобы обучить модель обнаружения объектов, необходимо создать проект Пользовательского визуального распознавания на основе учебного ресурса. Для этого воспользуйтесь порталом Пользовательского визуального распознавания.

1. Скачайте и извлеките обучающие образы из [https://aka.ms/animal-images](https://aka.ms/animal-images). Эти изображения предоставляются в zip-папке, которая при извлечении содержит вложенные папки, называемые **слоном**, **жирафом** и **львом**.

1. Откройте новую вкладку браузера и перейдите на портал Пользовательское визуальное распознавание по адресу [https://customvision.ai](https://customvision.ai?azure-portal=true). При появлении запроса войдите в систему, используя учетную запись Майкрософт, связанную с вашей подпиской Azure, и примите условия службы.

1. На портале Пользовательского визуального распознавания создайте новый проект со следующими параметрами:

    - **Имя**: Идентификация животных
    - **Описание**: Классификация изображений для животных
    - **Ресурс**: *созданный ранее ресурс Cognitive Services или Пользовательское визуальное распознавание.*
    - **Типы проектов**. Классификация
    - **Типы классификации**: по нескольким классам (один тег на изображение)
    - **Домены**: общие \[A2]

1. Щелкните **Добавить изображения** и выберите все файлы в папке **elephant** , извлеченной ранее. Затем отправьте файлы изображений, указав тег *elephant*, как показано ниже:

    ![Снимок экрана: интерфейс отправки изображений.](media/create-image-classification-system/upload-elephants.png)

1. Нажмите кнопку **Добавить изображения** ([+]), чтобы отправить изображения в папку **giraffe** с тегом *giraffe* и изображения в папке **lion** с тегом *lion*.

1. Изучите изображения, которые вы отправили в проект Пользовательское визуальное распознавание. Должно быть 17 изображений каждого класса, как показано ниже:

    ![Снимок экрана: изображения обучения с тегами на портале Пользовательское визуальное распознавание.](media/create-image-classification-system/animal-training-images.png)

1. В проекте Пользовательского визуального распознавания щелкните **Обучить** над изображениями, чтобы обучить модель классификации с использованием изображений с тегами. Выберите параметр **Быстрое обучение** и дождитесь завершения итерации обучения.

    > **Совет**. Обучение может занять несколько минут. Пока вы ждете, проверка[, как снежный барс селфи и ИИ могут помочь спасти виды от вымирания](https://news.microsoft.com/transform/snow-leopard-selfies-ai-save-species/), в котором описывается реальный проект, в котором используется компьютерное зрение для отслеживания находящихся под угрозой исчезновения животных в дикой природе.

1. При обучении итерации модели изучите метрики производительности *Точность*, *Полнота* и *Средняя точность*, которые характеризуют точность прогнозирования для модели классификации и все должны иметь высокие значения.

## Тестирование модели

Перед публикацией этой итерации модели для использования приложениями протестируйте ее.

1. Над метриками производительности щелкните **Быстрый тест**.

1. В поле **URL-адрес изображения** введите `https://aka.ms/giraffe` и нажмите кнопку **быстрого тестирования (&#10132;).**

1. Просмотрите прогнозы, возвращаемые моделью. Оценка вероятности *жирафа* должна быть самой высокой, как показано ниже:

    ![Снимок экрана: интерфейс быстрого тестирования.](media/create-image-classification-system/quick-test.png)

1. Закройте окно **Быстрый тест**.

## Публикация модели классификации изображений

Теперь вы готовы опубликовать обученную модель и использовать ее из клиентского приложения.

1. Щелкните **&#128504; Опубликовать**, чтобы опубликовать обученную модель со следующими параметрами:
    - **Имя модели**: animals
    - **Ресурс прогнозирования**. *Cognitive Services или Пользовательское визуальное распознавание ресурс прогнозирования, созданный ранее*.

1. После публикации щелкните *URL-адрес прогноза* (&#127760;), чтобы просмотреть сведения, необходимые для использования опубликованной модели.

    ![Снимок экрана: URL-адрес прогнозирования.](media/create-image-classification-system/prediction-url.png)

Позже вам потребуются соответствующие значения URL-адреса и Prediction-Key, чтобы получить прогноз из URL-адреса изображения, поэтому оставьте это диалоговое окно открытым и переходите к следующей задаче.

## Подготовка клиентского приложения

Чтобы протестировать возможности службы Пользовательское визуальное распознавание, мы будем использовать простое приложение командной строки, которое выполняется в Cloud Shell в Azure.

1. Вернитесь на вкладку браузера, содержащую портал Azure, и нажмите кнопку **Cloud Shell** (**[>_]**) в верхней части страницы справа от поля поиска. Откроется панель Cloud Shell в нижней части портала.

    При первом запуске Cloud Shell вам может быть предложено выбрать тип оболочки, которую вы будете использовать (*Bash* или *PowerShell*). Если да, выберите **PowerShell**.

    Если вам будет предложено создать хранилище для Cloud Shell, убедитесь, что выбрана подписка, и выберите **Создать хранилище**. Затем подождите минуту, пока хранилище не будет создано.

    Когда Cloud Shell будет готова, она должна выглядеть примерно так:
    
    ![Снимок экрана: Cloud Shell в портал Azure.](media/create-image-classification-system/cloud-shell.png)

    > **Совет**. Убедитесь, что в левом верхнем углу панели Cloud Shell указан тип оболочки *PowerShell*. Если там указана оболочка *Bash*, выберите *PowerShell* из раскрывающегося меню.

    Обратите внимание, что можно изменить размер Cloud Shell, перетащив разделительную полосу в верхней части области или воспользовавшись значками **&#8212;** , **&#9723;** и **X** в правом верхнем углу области для ее свертывания, развертывания или закрытия. Дополнительные сведения об использовании Azure Cloud Shell см. в [документации по Azure Cloud Shell](https://docs.microsoft.com/azure/cloud-shell/overview).

2. В командной оболочке введите следующие команды, чтобы скачать файлы для этого упражнения и сохранить их в папке **с именем ai-900** (после удаления этой папки, если она уже существует).

    ```PowerShell
    rm -r ai-900 -f
    git clone https://github.com/MicrosoftLearning/AI-900-AIFundamentals ai-900
    ```

3. Скачав файлы, введите следующие команды, чтобы перейти в каталог **ai-900** и изменить файл кода для этого упражнения:

    ```PowerShell
    cd ai-900
    code classify-image.ps1
    ```

    Обратите внимание, что откроется редактор, подобный приведенному на рисунке ниже:

     ![Снимок экрана: редактор кода в Cloud Shell.](media/create-image-classification-system/code-editor.png)

     > **Совет**. Для изменения размера панелей можно использовать разделители между командной строкой Cloud Shell и редактором кода.

4. Не стоит волноваться по поводу содержимого кода. Важно то, что он начинается с некоторого кода для указания URL-адреса и ключа прогнозирования для модели Пользовательское визуальное распознавание. Вам потребуется обновить их, чтобы остальная часть кода использовала вашу модель.

    Получите *URL-адрес прогнозирования* и *ключ прогнозирования* из диалогового окна, открытого на вкладке браузера для проекта Пользовательское визуальное распознавание. **Если *у вас есть URL-адрес образа*, необходимо использовать версии.**

    Используйте эти значения, чтобы заменить **заполнители YOUR_PREDICTION_URL** и **YOUR_PREDICTION_KEY** в файле кода.

    Когда вы вставите значения URL-адреса и ключа прогнозирования, первые две строки кода должны выглядеть так:

    ```PowerShell
    $predictionUrl="https..."
    $predictionKey ="1a2b3c4d5e6f7g8h9i0j...."
    ```

5. После внесения изменений в переменные в коде нажмите **клавиши CTRL+S** , чтобы сохранить файл. Затем нажмите **клавиши CTRL+Q** , чтобы закрыть редактор кода.

## Проверка клиентского приложения

Теперь вы можете использовать пример клиентского приложения для классификации изображений на основе содержащегося в них животного.

1. В области PowerShell введите следующую команду, чтобы выполнить код:

    ```PowerShell
    ./classify-image.ps1 1
    ```

    Этот код использует вашу модель для классификации следующего изображения:

    ![Фотография жирафа.](media/create-image-classification-system/animal-1.jpg)

1. Просмотрите прогноз, который должен быть **жирафом**.

1. Теперь попробуем еще один образ. Выполните следующую команду:

    ```PowerShell
    ./classify-image.ps1 2
    ```

    На этот раз классифицируется следующее изображение:

    ![Фотография слона.](media/create-image-classification-system/animal-2.jpg)

1. Убедитесь, что модель классифицирует это изображение как **слон**.

1. Давайте попробуем еще один. Выполните следующую команду:

    ```PowerShell
    ./classify-image.ps1 3
    ```

    Окончательное изображение выглядит следующим образом:

    ![Фотография льва.](media/create-image-classification-system/animal-3.jpg)

1. Убедитесь, что модель классифицирует это изображение как **лев**.

Мы надеемся, что модель классификации изображений правильно классифицировала все три изображения.

## Подробнее

В этом упражнении показаны только некоторые возможности службы Пользовательское визуальное распознавание. Дополнительные сведения о том, что можно сделать с помощью этой службы, см. на [странице Пользовательского визуального распознавания](https://azure.microsoft.com/services/cognitive-services/custom-vision-service/).
