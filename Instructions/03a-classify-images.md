---
lab:
  title: Изучение классификации изображений
---

# <a name="explore-image-classification"></a>Изучение классификации изображений

> **Примечание**. Для выполнения этого задания вам потребуется [подписка Azure](https://azure.microsoft.com/free?azure-portal=true), в которой у вас есть административный доступ.

Служба *Компьютерное зрение* в Cognitive Services предоставляет полезные готовые модели для обработки изображений, но для использования возможностей компьютерного зрения вам часто потребуется обучить собственную модель. Предположим, что компания розничной торговли Northwind Traders хочет создать систему касс самообслуживания, которая определяет продукты, приобретаемые клиентами, на основе изображения с камеры на кассе. Для этого необходимо обучить модель классификации, которая сможет обрабатывать изображения и определять приобретаемый продукт.

В Azure можно использовать службу ***Пользовательское визуальное распознавание*** для обучения модели классификации изображений на основе существующих изображений. Есть два момента, которые нужно учитывать при создании решения для классификации изображений. Во-первых, вы должны обучить модель распознавать разные классы с использованием существующих изображений. Затем, когда модель обучена, ее необходимо опубликовать как службу, которая может использоваться приложениями.

Чтобы протестировать возможности службы "Компьютерное зрение", мы используем простое приложение командной строки, которое выполняется в Cloud Shell. Те же принципы и функциональные возможности реализованы и в реальных решениях, таких как веб-сайты и приложения для телефонов.

## <a name="create-a-cognitive-services-resource"></a>Создание ресурса *Cognitive Services*

Для работы со службой "Пользовательское визуальное распознавание" можно создать ресурс **Пользовательского визуального распознавания** или **Cognitive Services**.

>**Примечание** Некоторые ресурсы недоступны в некоторых регионах. При создании как ресурса Пользовательского визуального распознавания, так и ресурса Cognitive Services для доступа к службам Пользовательского визуального распознавания можно использовать только ресурсы, созданные в [определенных регионах](https://azure.microsoft.com/global-infrastructure/services/?products=cognitive-services). Для удобства в инструкциях по конфигурации ниже регион выбран заранее.

Создайте ресурс **Cognitive Services** в подписке Azure.

1. На другой вкладке браузера откройте портал Azure по адресу [https://portal.azure.com](https://portal.azure.com?azure-portal=true) и войдите в него, используя свою учетную запись Майкрософт.

1. Нажмите кнопку **&#65291; Создать ресурс**, выполните поиск по запросу *Cognitive Services* и создайте ресурс **Cognitive Services** со следующими параметрами:
    - **Подписка**: *ваша подписка Azure*.
    - **Группа ресурсов**: *выберите существующую или создайте новую группу ресурсов с уникальным именем*.
    - **Регион:** восточная часть США.
    - **Имя**: *укажите уникальное имя*.
    - **Ценовая категория**: Стандартный S0.
    - **Устанавливая этот флажок, я подтверждаю, что мною прочитаны все приведенные ниже условия и я понимаю их**: флажок установлен.

1. Проверьте и создайте ресурс, а затем дождитесь завершения развертывания. Затем перейдите к развернутому ресурсу.

1. Откройте страницу **Ключи и конечная точка** для своего ресурса Cognitive Services. Для подключения из клиентских приложений потребуются конечная точка и ключи.

## <a name="create-a-custom-vision-project"></a>Создание проекта в службе "Пользовательское визуальное распознавание"

Чтобы обучить модель обнаружения объектов, необходимо создать проект Пользовательского визуального распознавания на основе учебного ресурса. Для этого воспользуйтесь порталом Пользовательского визуального распознавания.

1. Скачайте и извлеките обучающие изображения отсюда: https://aka.ms/fruit-images. Эти изображения предоставляются в запакованной папке (файл ZIP), которая содержит вложенные папки **apple**, **banana** и **orange**.

1. На другой вкладке браузера откройте портал Пользовательского визуального распознавания по адресу [https://customvision.ai](https://customvision.ai?azure-portal=true). При появлении запроса войдите в систему, используя учетную запись Майкрософт, связанную с вашей подпиской Azure, и примите условия службы.

1. На портале Пользовательского визуального распознавания создайте новый проект со следующими параметрами:

    - **Имя**: Grocery Checkout.
    - **Описание**: классификация изображений продуктов.
    - **Ресурс**: *созданный ранее ресурс Пользовательского визуального распознавания*.
    - **Типы проектов**. Классификация
    - **Типы классификации**: по нескольким классам (один тег на изображение)
    - **Предметные области**: продукты питания.

1. Нажмите **Добавить изображения** и выберите все файлы в папке **apple**, которые были распакованы ранее. Затем отправьте файлы изображений, указав тег *apple* следующим образом:

    ![Отправка изображения яблока с тегом apple](media/create-image-classification-system/upload-apples.jpg)

1. Повторите предыдущий шаг, чтобы отправить изображения в папке **banana** с тегом *banana*, а изображения в папке **orange** — с тегом *orange*.

1. Просмотрите изображения, отправленные в проект Пользовательского визуального распознавания. Вы должны иметь 15 изображений каждого класса:

    ![Помеченные тегами изображения фруктов — 15 изображений яблок, 15 изображений бананов и 15 изображений апельсинов](media/create-image-classification-system/fruit.jpg)

1. В проекте Пользовательского визуального распознавания щелкните **Обучить** над изображениями, чтобы обучить модель классификации с использованием изображений с тегами. Выберите вариант **Быстрое обучение** и дождитесь завершения итерации обучения (на это может потребоваться около минуты).

1. При обучении итерации модели изучите метрики производительности *Точность*, *Полнота* и *Средняя точность*, которые характеризуют точность прогнозирования для модели классификации и все должны иметь высокие значения.

## <a name="test-the-model"></a>Тестирование модели

Перед публикацией этой итерации модели для использования приложениями протестируйте ее.

1. Над метриками производительности щелкните **Быстрый тест**.

1. В поле **URL-адрес изображения** введите `https://aka.ms/apple-image` и щелкните &#10132;.

1. Просмотрите прогнозы, возвращенные модели. Оценка вероятности для *apple* должна быть самой высокой:

    ![Изображение с прогнозом класса apple](media/create-image-classification-system/test-apple.jpg)

1. Закройте окно **Быстрый тест**.

## <a name="publish-the-image-classification-model"></a>Публикация модели классификации изображений

Теперь вы готовы опубликовать обученную модель и использовать ее из клиентского приложения.

1. Щелкните **&#128504; Опубликовать**, чтобы опубликовать обученную модель со следующими параметрами:
    - **Имя модели**: groceries.
    - **Ресурс прогнозирования**: *созданный ранее ресурс прогнозирования*.

1. После публикации щелкните *URL-адрес прогноза* (&#127760;), чтобы просмотреть сведения, необходимые для использования опубликованной модели. Позже вам потребуются соответствующие значения URL-адреса и Prediction-Key, чтобы получить прогноз из URL-адреса изображения, поэтому оставьте это диалоговое окно открытым и переходите к следующей задаче. 

## <a name="run-cloud-shell"></a>Запуск Cloud Shell

Чтобы протестировать возможности службы Компьютерного зрения, мы используем простое приложение командной строки, которое выполняется в Cloud Shell в Azure.

1. На портале Azure нажмите кнопку **[>_]** (*Cloud Shell*) в верхней части страницы справа от поля поиска. В нижней части портала откроется панель Cloud Shell. 

    ![Запустите Cloud Shell, нажав значок справа от верхнего поля поиска.](media/create-image-classification-system/powershell-portal-guide-1.png)

1. При первом запуске Cloud Shell вам может быть предложено выбрать тип оболочки, которую вы будете использовать (*Bash* или *PowerShell*). Выберите ссылку **PowerShell**. В противном случае пропустите этот шаг.  

1. Если вам будет предложено создать хранилище для Cloud Shell, укажите свою подписку и нажмите **Создать хранилище**. Затем подождите минуту, пока хранилище не будет создано.

    [![Нажмите "Подтвердить", чтобы создать хранилище.](media/create-image-classification-system/powershell-portal-guide-2.png)](media/create-image-classification-system/powershell-portal-guide-2.png#lightbox)

1. Убедитесь, что тип оболочки в левом верхнем углу панели Cloud Shell изменился на *PowerShell*. Если там указана оболочка *Bash*, выберите *PowerShell* из раскрывающегося меню.

    ![Как найти раскрывающееся меню слева для переключения на PowerShell](media/create-image-classification-system/powershell-portal-guide-3.png)

1. Дождитесь запуска PowerShell. На портале Azure должен отобразиться следующий экран:  

    ![Дождитесь запуска PowerShell.](media/create-image-classification-system/powershell-prompt.png)

## <a name="configure-and-run-a-client-application"></a>Настройка и запуск клиентского приложения

Теперь, когда у вас есть среда Cloud Shell, можно запустить простое приложение, использующее службу "Пользовательское визуальное распознавание" для анализа изображений.

1. В командной оболочке введите следующую команду, чтобы скачать пример приложения и сохранить его в папку ai-900. 

    ```PowerShell
    git clone https://github.com/MicrosoftLearning/AI-900-AIFundamentals ai-900
    ```

    >**Совет**. Если вы уже использовали эту команду в другом задании для клонирования репозитория *ai-900*, этот шаг можно пропустить.

1. Файлы скачиваются в папку **ai-900**. Теперь нам нужно просмотреть все файлы в хранилище Cloud Shell и поработать с ними. Введите в оболочке следующую команду:

    ```PowerShell
    code .
    ```

    Обратите внимание, что откроется редактор, подобный следующему: 

    ![Редактор кода.](media/create-image-classification-system/powershell-portal-guide-4.png)

1. В области **Файлы** слева разверните узел **ai-900** и выберите файл **classify-image.ps1**. Этот файл содержит код, который использует модель Пользовательского визуального распознавания для анализа изображения, как показано ниже:

     ![Редактор, содержащий код для классификации изображений](media/create-image-classification-system/classify-image-code.png)

1. Не беспокойтесь слишком о деталях кода. Важно то, что при использовании URL-адреса изображения требуется URL-адрес и ключ прогнозирования для вашей модели Пользовательского визуального распознавания. 

   Получите *URL-адрес прогнозирования* из диалогового окна в проекте Пользовательского визуального распознавания. 

   >**Примечание** Помните, что вы просматривали этот *URL-адрес прогнозирования* после публикации модели классификации изображений. Чтобы найти *URL-адрес прогнозирования*, перейдите на вкладку **Производительность** в проекте, а затем щелкните **Prediction URL** (URL-адрес прогнозирования) (если экран сжат, может отображаться только значок глобуса). Появится диалоговое окно. Скопируйте URL-адрес для поля **При наличии URL-адреса изображения**. Вставьте его в редактор кода, заменив значение заполнителя **YOUR_PREDICTION_URL**.

    В этом же диалоговом окне получите *ключ прогнозирования*. Скопируйте ключ прогнозирования, отображаемый после нажатия *Задать значение для заголовка ключа прогнозирования*. Вставьте его в редактор кода, заменив значение заполнителя **YOUR_PREDICTION_KEY**.

    ![Снимок экрана: URL-адрес прогнозирования.](media/create-image-classification-system/find-prediction-url.png)

    Когда вы вставите значения URL-адреса и ключа прогнозирования, первые две строки кода должны выглядеть так:

    ```PowerShell
    $predictionUrl="https..."
    $predictionKey ="1a2b3c4d5e6f7g8h9i0j...."
    ```

1. В правом верхнем углу панели редактора нажмите кнопку **...**, чтобы открыть меню, и выберите **Сохранить**, чтобы сохранить свои изменения. Затем снова откройте меню и выберите пункт **Закрыть редактор**.

    Этот пример клиентского приложения позволит вам классифицировать несколько изображений по категориям apple, banana или orange.

1. Мы будем классифицировать следующее изображение:

    ![Изображение яблока](media/create-image-classification-system/fruit-1.jpg)

    В области PowerShell введите следующие команды для запуска кода:

    ```PowerShell
    cd ai-900
    ./classify-image.ps1 1
    ```

1. Просмотрите прогноз, который должен иметь значение **apple**.

1. Теперь давайте попробуем еще одно изображение:

    ![Изображение банана](media/create-image-classification-system/fruit-2.jpg)

    Выполните следующую команду:

    ```PowerShell
    ./classify-image.ps1 2
    ```

1. Убедитесь, что модель классифицирует это изображение как **banana**.

1. Наконец, обработайте третье тестовое изображение:

    ![Изображение апельсина](media/create-image-classification-system/fruit-3.jpg)

    Выполните следующую команду:

    ```PowerShell
    ./classify-image.ps1 3
    ```

1. Убедитесь, что модель классифицирует это изображение как **orange**.

## <a name="learn-more"></a>Дополнительные сведения

В этом простом приложении демонстрируются лишь некоторые возможности службы Пользовательского визуального распознавания. Дополнительные сведения о том, что можно сделать с помощью этой службы, см. на [странице Пользовательского визуального распознавания](https://azure.microsoft.com/services/cognitive-services/custom-vision-service/).
